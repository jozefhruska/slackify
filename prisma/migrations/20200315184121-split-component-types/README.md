# Migration `20200315184121-split-component-types`

This migration has been generated by Jozef Hru≈°ka at 3/15/2020, 6:41:21 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "ComponentType" AS ENUM ('PLAIN_TEXT', 'ARTICLE', 'LINK');

CREATE TABLE "public"."PlainTextComponentData" (
    "id" text  NOT NULL ,
    "text" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."ArticleComponentData" (
    "component" text  NOT NULL ,
    "content" text   ,
    "id" text  NOT NULL ,
    "lead" text  NOT NULL DEFAULT '',
    "title" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."LinkComponentData" (
    "id" text  NOT NULL ,
    "text" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."Collection" ALTER COLUMN "id" SET DEFAULT '';

ALTER TABLE "public"."Component" DROP CONSTRAINT IF EXiSTS "Component_collection_fkey",
DROP COLUMN "collection",
DROP COLUMN "content",
DROP COLUMN "isPublished",
DROP COLUMN "short",
DROP COLUMN "title",
ADD COLUMN "collection_handle" text  NOT NULL ,
ADD COLUMN "collection_team" text  NOT NULL ,
ADD COLUMN "published" boolean  NOT NULL DEFAULT false,
DROP COLUMN "type",
ADD COLUMN "type" "ComponentType" NOT NULL DEFAULT 'ARTICLE';

CREATE UNIQUE INDEX "Collection.handle_team" ON "public"."Collection"("handle","team")

ALTER TABLE "public"."ArticleComponentData" ADD FOREIGN KEY ("component")REFERENCES "public"."Component"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Component" ADD FOREIGN KEY ("collection_handle", "collection_team")REFERENCES "public"."Collection"("handle","team") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200315172318-rename-post-to-component..20200315184121-split-component-types
--- datamodel.dml
+++ datamodel.dml
@@ -1,9 +1,9 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRES_URL")
   enabled  = env("POSTGRES_URL")
-  // url = "***"
+  // url      = "postgresql://postgres:password@localhost:5432/postgres"
 }
 generator cient_prisma {
   provider = "prisma-client-js"
@@ -39,29 +39,51 @@
   image_512   String?
 }
 model Collection {
-  id         String      @default(cuid()) @id
+  id         String      @default(cuid())
   handle     String
   team       Team
   components Component[]
+
+  @@unique([handle, team])
 }
 model Team {
-  id          String @id
+  id          String       @id
   name        String
-  domain      String @unique
-  accessToken String @unique
+  domain      String       @unique
+  accessToken String       @unique
+  collections Collection[]
 }
 model Component {
-  id          String     @default(cuid()) @id
-  type        String
-  title       String
-  short       String
-  content     String?
-  isPublished Boolean
-  collection  Collection
-  author      User
-  createdAt   DateTime   @default(now())
-  updatedAt   DateTime   @updatedAt
+  id         String        @default(cuid()) @id
+  type       ComponentType @default(ARTICLE)
+  published  Boolean       @default(false)
+  collection Collection
+  author     User
+  createdAt  DateTime      @default(now())
+  updatedAt  DateTime      @updatedAt
+}
+
+model PlainTextComponentData {
+  id   String @default(cuid()) @id
+  text String
+}
+
+model ArticleComponentData {
+  id        String    @default(cuid()) @id
+  title     String
+  lead      String
+  content   String?
+  component Component
+}
+
+model LinkComponentData {
+  id   String @default(cuid()) @id
+  text String
+}
+
+enum ComponentType {
+  PLAIN_TEXT ARTICLE LINK
 }
```


